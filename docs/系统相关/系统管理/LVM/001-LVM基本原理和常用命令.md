## ğŸ§  ä¸€ã€LVM åŸºæœ¬åŸç†

LVM æ˜¯ Linux ä¸‹çš„ä¸€ç§çµæ´»çš„ç£ç›˜ç®¡ç†æœºåˆ¶ï¼Œç”¨äºåŠ¨æ€åœ°è°ƒæ•´å­˜å‚¨ç©ºé—´ï¼Œæ¯”ä¼ ç»Ÿåˆ†åŒºæ›´æ–¹ä¾¿æ‰©å®¹å’Œç®¡ç†ã€‚

### 1ï¸âƒ£ å…³é”®æ¦‚å¿µ

| åç§°     | å…¨ç§°                    | è¯´æ˜                                                                     |
| ------ | --------------------- | ---------------------------------------------------------------------- |
| **PV** | Physical Volumeï¼ˆç‰©ç†å·ï¼‰  | å®é™…ç‰©ç†å­˜å‚¨å•å…ƒï¼ˆå¦‚ `/dev/sda1`ã€`/dev/nvme0n1p2` ç­‰ï¼‰ï¼Œç»è¿‡ `pvcreate` åˆå§‹åŒ–åæ‰èƒ½ç”¨äº LVMã€‚ |
| **VG** | Volume Groupï¼ˆå·ç»„ï¼‰      | å°†å¤šä¸ª PV èšåˆæˆä¸€ä¸ªå¤§çš„å­˜å‚¨æ± ï¼ˆä¾‹å¦‚ `vg0`ï¼‰ã€‚                                           |
| **LV** | Logical Volumeï¼ˆé€»è¾‘å·ï¼‰   | ä» VG ä¸­åˆ’å‡ºçš„é€»è¾‘åˆ†åŒºï¼Œå¯æŒ‚è½½ã€æ ¼å¼åŒ–ã€æ‰©å®¹ã€ç¼©å®¹ã€‚ç±»ä¼¼ä¼ ç»Ÿçš„ `/dev/sdaX`ã€‚                         |
| **PE** | Physical Extentï¼ˆç‰©ç†æ‰©å±•ï¼‰ | VG ä¸­çš„æœ€å°åˆ†é…å•å…ƒï¼ˆé»˜è®¤ 4MBï¼‰ã€‚                                                   |
| **LE** | Logical Extentï¼ˆé€»è¾‘æ‰©å±•ï¼‰  | LV ä¸­çš„æœ€å°åˆ†é…å•å…ƒï¼Œä¸ PE ä¸€ä¸€å¯¹åº”ã€‚                                                 |

ğŸ“Š ç®€å•ç»“æ„ç¤ºæ„å›¾ï¼š

```lua
+-----------+     +-----------+
  |  /dev/sda |     |  /dev/sdb |
  +-----------+     +-----------+
        |                 |
      [ PV ]            [ PV ]
         \               /
          \             /
           +-----------+
           |   VG vg0  |
           +-----------+
           |    LV1    | --> / (root)
           |    LV2    | --> /data
           +-----------+
```

---

## âš™ï¸ äºŒã€LVM å¸¸ç”¨å‘½ä»¤

### 1ï¸âƒ£ åˆ›å»º LVM çš„å®Œæ•´æµç¨‹

#### ï¼ˆ1ï¼‰åˆ›å»ºç‰©ç†å·ï¼ˆPVï¼‰

```bash
pvcreate /dev/sda2 /dev/sdb1
```

#### ï¼ˆ2ï¼‰æŸ¥çœ‹ PV

```bash
pvs        # ç®€ç•¥ä¿¡æ¯
pvdisplay  # è¯¦ç»†ä¿¡æ¯
```

---

#### ï¼ˆ3ï¼‰åˆ›å»ºå·ç»„ï¼ˆVGï¼‰

```bash
vgcreate vg0 /dev/sda2 /dev/sdb1
```

#### ï¼ˆ4ï¼‰æŸ¥çœ‹ VG

```bash
vgs         # ç®€ç•¥ä¿¡æ¯
vgdisplay   # è¯¦ç»†ä¿¡æ¯
```

---

#### ï¼ˆ5ï¼‰åˆ›å»ºé€»è¾‘å·ï¼ˆLVï¼‰

ä¾‹å¦‚åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º 100G çš„é€»è¾‘å·ï¼š

```bash
lvcreate -n lv_data -L 100G vg0
```

æˆ–ä½¿ç”¨å‰©ä½™å…¨éƒ¨ç©ºé—´ï¼š

```bash
lvcreate -n lv_data -l 100%FREE vg0
```

#### ï¼ˆ6ï¼‰æŸ¥çœ‹ LV

```bash
lvs         # ç®€ç•¥ä¿¡æ¯
lvdisplay   # è¯¦ç»†ä¿¡æ¯
```

---

#### ï¼ˆ7ï¼‰æ ¼å¼åŒ–å¹¶æŒ‚è½½

```bash
mkfs.xfs /dev/vg0/lv_data
mkdir /data
mount /dev/vg0/lv_data /data
```

---

### 2ï¸âƒ£ æ‰©å®¹é€»è¾‘å·ï¼ˆæœ€å¸¸ç”¨ï¼‰

#### ï¼ˆ1ï¼‰æ‰©å±• LV ç©ºé—´

ä¾‹å¦‚æ‰©å±•åˆ° 200Gï¼š

```bash
lvextend -L 200G /dev/vg0/lv_data
```

æˆ–ä½¿ç”¨å·ç»„å‰©ä½™å…¨éƒ¨ç©ºé—´ï¼š

```bash
lvextend -l +100%FREE /dev/vg0/lv_data
```

#### ï¼ˆ2ï¼‰åœ¨çº¿æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ

æ ¹æ®æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼š

```bash
# XFS æ–‡ä»¶ç³»ç»Ÿ
xfs_growfs /data

# EXT4 æ–‡ä»¶ç³»ç»Ÿ
resize2fs /dev/vg0/lv_data
```

---

### 3ï¸âƒ£ ç¼©å°é€»è¾‘å·ï¼ˆéœ€å°å¿ƒâš ï¸ï¼‰

> âš ï¸ ç¼©å®¹å‰å¿…é¡»å…ˆå¸è½½å¹¶æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼

```bash
umount /data
e2fsck -f /dev/vg0/lv_data       # æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ
resize2fs /dev/vg0/lv_data 80G   # è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°
lvreduce -L 80G /dev/vg0/lv_data # ç¼©å°é€»è¾‘å·
mount /data
```

> â— XFS æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒåœ¨çº¿ç¼©å®¹ï¼

---

### 4ï¸âƒ£ æ‰©å±•å·ç»„ï¼ˆVGï¼‰

å¦‚æœ VG ç©ºé—´ä¸å¤Ÿï¼Œå¯æ·»åŠ æ–°çš„ PVï¼š

```bash
pvcreate /dev/sdc1
vgextend vg0 /dev/sdc1
```

---

### 5ï¸âƒ£ åˆ é™¤ LVM

```bash
umount /data
lvremove /dev/vg0/lv_data
vgremove vg0
pvremove /dev/sda2 /dev/sdb1
```

---

### 6ï¸âƒ£ å¸¸ç”¨æŸ¥çœ‹å‘½ä»¤æ€»ç»“

| å‘½ä»¤ | è¯´æ˜ |
| --- | --- |
| `pvs`, `pvdisplay` | æŸ¥çœ‹ç‰©ç†å·ä¿¡æ¯ |
| `vgs`, `vgdisplay` | æŸ¥çœ‹å·ç»„ä¿¡æ¯ |
| `lvs`, `lvdisplay` | æŸ¥çœ‹é€»è¾‘å·ä¿¡æ¯ |
| `lvscan` | æ‰«æç³»ç»Ÿä¸­çš„é€»è¾‘å· |
| `vgscan` | æ‰«æå·ç»„ |
| `pvscan` | æ‰«æç‰©ç†å· |

---

## ğŸ“˜ ä¸‰ã€ä¸€ä¸ªå®Œæ•´ä¾‹å­

```bash
# 1. åˆ›å»ºç‰©ç†å·
pvcreate /dev/nvme0n1 /dev/nvme1n1

# 2. åˆ›å»ºå·ç»„
vgcreate vg0 /dev/nvme0n1 /dev/nvme1n1

# 3. åˆ›å»ºé€»è¾‘å·
lvcreate -n lv_root -L 200G vg0

# 4. æ ¼å¼åŒ–å¹¶æŒ‚è½½
mkfs.xfs /dev/vg0/lv_root
mkdir /mnt/root
mount /dev/vg0/lv_root /mnt/root

# 5. æ‰©å®¹é€»è¾‘å·
lvextend -l +100%FREE /dev/vg0/lv_root
xfs_growfs /mnt/root
```

---