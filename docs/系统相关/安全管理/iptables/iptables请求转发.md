## 背景

- 将访问2.2.2.2机器的3389端口请求转发到2.2.2.2机器上的内网网段的10.155.0.251:3389
- 只针对从堡垒机1.1.1.1这个IP放开


## 配置

### **命令**

```
iptables -t nat -A PREROUTING -s 1.1.1.1 -d 2.2.2.2 -m tcp -p tcp --dport 3389 -j DNAT --to 10.155.0.251:3389
```

### **各字段解释**

1. **-t nat**
    
    使用的是 **nat 表**，主要用于网络地址转换（DNAT / SNAT / MASQUERADE）。
    
2. **-A PREROUTING**
    
    在 **PREROUTING 链**追加规则，数据包刚到达防火墙时（路由判断前）就会先走这里。
    
    → 适合做目标地址转换（DNAT）。
    
3. **-s 1.1.1.1**
    
    仅匹配 **源 IP 为 1.1.1.1** 的数据包。
    
4. **-d 2.2.2.2**
    
    仅匹配 **目标 IP 为 2.2.2.2** 的数据包。
    
    （通常是本机某个公网 IP）。
    
5. **-m tcp -p tcp --dport 3389**
    
    匹配 **TCP 协议，目标端口是 3389**（远程桌面 RDP 默认端口）。
    
6. **-j DNAT --to 10.155.0.251:3389**
    
    动作是 **目标地址转换 (DNAT)**，把目的 IP:端口 2.2.2.2:3389 转换为内网主机 10.155.0.251:3389。
    

---

### **规则效果**

只有满足以下条件的 TCP 数据包会被转发：

- 源地址：1.1.1.1
    
- 目标地址：2.2.2.2
    
- 目标端口：3389
    

这些包会被 DNAT，改写为：

- 新的目标地址：10.155.0.251
    
- 新的目标端口：3389
    

  

换句话说：

👉 只允许 **来自 1.1.1.1 的主机** 访问 2.2.2.2:3389，并且会被透明转发到内网的 10.155.0.251:3389。

---

### **实际用途**

- **内网穿透**：让外部的 1.1.1.1 可以通过公网 IP 2.2.2.2:3389，访问内网机器 10.155.0.251:3389。
    
- **安全控制**：加了 -s 1.1.1.1 限制来源，避免所有人都能直接连上 3389，只允许指定 IP。