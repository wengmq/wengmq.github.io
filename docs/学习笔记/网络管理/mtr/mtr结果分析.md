
- 参考：https://22vps.com/p/1Brm4vd



## **MTR示例输出**

![](assets/Pasted%20image%2020240614114705.png)


## **返回结果说明**

默认配置下，返回结果中各数据列的说明如下。

- 第一列（Host）：节点IP地址和域名。如前面所示，按n键可以切换显示。
    

- 第二列（Loss%）：节点丢包率。
    

- 第三列（Snt）：每秒发送数据包数。默认值是10，可以通过参数“-c”指定。
    

- 第四列（Last）：最近一次的探测延迟值。
    

- 第五、六、七列（Avg、Best、Wrst）：分别是探测延迟的平均值、最小值和最大值。
    
- 第八列（StDev）：标准偏差。越大说明相应节点越不稳定。


## 结果分析

- 本文以其测试结果为例，对链路测试结果的分析进行简要说明。后续的说明，以如下链路测试结果示例图为基础进行阐述。

![](assets/Pasted%20image%2020240614140512.png)

- **对链路测试结果进行分析时，需要关注如下几点：**

	- 网络区域
	    
	
	- 链路负载均衡
	    
	
	- 结合Avg（平均值）和 StDev（标准偏差）综合判断
	    
	
	- Loss%（丢包率）的判断
	    
	- 延迟


#### 网络区域

> [!NOTE]
> 正常情况下，从客户端到目标服务器的整个链路，会显著的包含如下区域：
> 
> **客户端本地网络：**本地局域网和本地网络提供商网络。如前文链路测试结果示例图中的区域A。如果该区域出现异常，如果是客户端本地网络相关节点出现异常，则需要对本地网络进行相应排查分析。否则，如果是本地网络提供商网络相关节点出现异常，则需要向当地运营商反馈问题。
> 
> **运营商网络：**如前文链路测试结果示例图中的区域B。如果该区域出现异常，可以根据异常节点IP查询归属运营商，然后直接或通过阿里云售后技术支持，向相应运营商反馈问题。  
> **目标服务器本地网络：**目标主机归属网络提供商网络。如前文链路测试结果示例图中的区域C。如果该区域出现异常，则需要向目标主机归属网络提供商反馈问题。
> 
> **链路负载均衡：**如前文链路测试结果示例图中的区域D。如果中间链路某些部分启用了链路负载均衡，则mtr命令只会对首尾节点进行编号和探测统计。中间节点只会显示相应的IP或域名信息。
> 

#### 结合Avg（平均值）和StDev（标准偏差）综合判断

> [!NOTE]
> 由于链路抖动或其它因素的影响，节点的Best和Worst值可能相差很大。而Avg（平均值）统计了自链路测试以来所有探测的平均值，所以能更好的反应出相应节点的网络质量。而StDev（标准偏差值）越高，则说明数据包在相应节点的延时值越不相同（越离散）。所以标准偏差值可用于协助判断Avg是否真实反应了相应节点的网络质量。例如，如果标准偏差很大，说明数据包的延迟是不确定的。可能某些数据包延迟很小（例如：25ms），而另一些延迟却很大（例如：350ms），但最终得到的平均延迟反而可能是正常的。所以此时Avg并不能很好的反应出实际的网络质量情况。
> 
> 综上，建议的分析标准如下：
> 
> - 如果StDev很高，则同步观察相应节点的Best和Wrst，来判断相应节点是否存在异常。
>     
> - 如果StDev不高，则通过Avg来判断相应节点是否存在异常。
>     
>     > **说明**：上述StDev“高”或者“不高”，并没有具体的时间范围标准。而需要根据同一节点其它列的延迟值大小来进行相对评估。例如，如果Avg为30ms，那么，当StDev为25ms，则认为是很高的偏差。而如果Avg为325ms，则同样的StDev（25ms），反而认为是不高的偏差。
>     
> 

#### Loss%（丢包率）的判断

> [!NOTE]
> 任一节点的Loss%（丢包率）如果不为零，则说明这一跳网络可能存在问题。导致相应节点丢包的原因通常有两种。
> 
> - 运营商基于安全或性能需求，人为限制了节点的ICMP发送速率，导致丢包。
>     
> 
> - 节点确实存在异常，导致丢包。
>     
> 
> 可以结合异常节点及其后续节点的丢包情况，来判定丢包原因。
> 
> - 如果随后节点均没有丢包，则通常说明异常节点丢包是由于运营商策略限制所致。可以忽略相关丢包。如前文链路测试结果示例图中的第2跳所示。
>     
> 
> - 如果随后节点也出现丢包，则通常说明异常节点确实存在网络异常，导致丢包。如前文链路测试结果示例图中的第5跳所示。
>     
> - 另外，需要说明的是，前述两种情况可能同时发生。即相应节点既存在策略限速，又存在网络异常。对于这种情况，如果异常节点及其后续节点连续出现丢包，而且各节点的丢包率不同，则通常以最后几跳的丢包率为准。如前文链路测试结果示例图所示，在第 5、6、7跳均出现了丢包。所以，最终丢包情况，以第7跳的40%作为参考。

    

#### 关于延迟

> [!NOTE]
> ##### 延迟跳变
> 
> 如果在某一跳之后延迟明显陡增，则通常判断该节点存在网络异常。如前文链路测试结果示例图所示，从第5跳之后的后续节点延迟明显陡增，则推断是第5跳节点出现了网络异常。不过，高延迟并不一定完全意味着相应节点存在异常。如前文链路测试结果示例图所示，第5跳之后，虽然后续节点延迟明显陡增，但测试数据最终仍然正常到达了目的主机。所以，延迟大也有可能是在数据回包链路中引发的。所以，最好结合反向链路测试一并分析。
> 
> ##### ICMP限速导致延迟增加
> 
> ICMP策略限速也可能会导致相应节点的延迟陡增，但后续节点通常会恢复正常。如前文链路测试结果示例图所示，第3跳有 100%的丢包率，同时延迟也明显陡增。但随后节点的延迟马上恢复了正常。所以判断该节点的延迟陡增及丢包是由于策略限速所致。



## 常见链路异常场景和测试报告分析

- #### 目标主机网络配置不当
![](assets/Pasted%20image%2020240614144038.png)
如上图所示，在该示例中，数据包在目标地址出现了100%的丢包。乍一看是数据包没有到达，其实很有可能是目标服务器相关安全策略，例如防火墙、iptables等禁用了ICMP所致，导致目的主机无法发送任何应答。所以，该场景需要排查目标服务器的安全策略配置。

- ## ICMP限速
![](assets/Pasted%20image%2020240614144155.png)
如上图所示，时延到13跳的时候突然增加，并且后面几条的时延也很高，很可能是这一跳的运营商做了ICMP限速

- ## 环路
![](assets/Pasted%20image%2020240614144347.png)
如上图所示，在该示例中数据包在第5跳之后出现了循环跳转，导致最终无法到达目标服务器。这通常是由于运营商相关节点路由配置异常所致。所以，该场景需要联系相应节点归属运营商处理。


- ## 链路中断
![](assets/Pasted%20image%2020240614144624.png)